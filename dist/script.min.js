function initGame(){ctx.fillStyle="black";for(var a=0;a<world.length;a++)world[a]=new Array(width),savedFirstGen[a]=new Array(width);for(a=0;a<width;a++)for(var b=0;b<height;b++)world[a][b]=0;c.width=width*scale,c.height=height*scale}function setRandomPoints(){for(var a=0;a<width;a++)for(var b=0;b<height;b++)Math.random()<fillPercent?world[a][b]=1:world[a][b]=0;draw()}function copyArray(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<a[c].length;d++)b[c][d]=a[c][d]}function isAlive(a,b){return 1===world[a][b]}function neighborsNum(a,b,c){return c[a-1][b-1]+c[a][b-1]+c[a+1][b-1]+c[a-1][b]+c[a+1][b]+c[a-1][b+1]+c[a][b+1]+c[a+1][b+1]}function draw(){ctx.clearRect(0,0,width*scale,height*scale);for(var a=0;a<world.length;a++)for(var b=0;b<world[a].length;b++)isAlive(a,b)&&ctx.fillRect(a*scale,b*scale,scale,scale)}function step(){var a,b,c=new Array(height+2);for(a=0;a<c.length;a++)c[a]=new Array(width+2);for(a=0;a<c.length;a++)for(b=0;b<c[a].length;b++)c[a][b]=0;for(a=0;a<world.length;a++)for(b=0;b<world[a].length;b++)c[a+1][b+1]=world[a][b];for(a=0;a<world.length;a++)for(b=0;b<world[a].length;b++){var d=neighborsNum(a+1,b+1,c);isAlive(a,b)?2!==d&&3!==d&&(world[a][b]=0):3===d&&(world[a][b]=1)}draw()}function getMousePos(a,b){var c=a.getBoundingClientRect();return{x:Math.floor((b.clientX-c.left)/scale),y:Math.floor((b.clientY-c.top)/scale)}}function playControl(a,b){"start"===a&&!1===blockingStart&&(game=setInterval(step,b),blockingStart=!0),"stop"===a&&(clearInterval(game),blockingStart=!1,start.innerText="Start"),"pause"===a&&(clearInterval(game),blockingStart=!1)}var c=document.getElementById("c"),ctx=c.getContext("2d"),sart=document.getElementById("start"),stop=document.getElementById("stop"),pause=document.getElementById("pause"),next=document.getElementById("next"),mouseX=document.getElementById("mouseX"),mouseY=document.getElementById("mouseY"),customGen=document.getElementById("customGen"),saveCurrent=document.getElementById("saveCurrent"),firstGenRandom=document.getElementById("firstGenRandom"),scaleInput=document.getElementById("scale"),fillInput=document.getElementById("fill"),speedInput=document.getElementById("speed"),speed=speedInput.value,game=0,scale=2,blockingStart=!1,width=200,height=200,fillPercent=.3,world=new Array(height),savedFirstGen=new Array(height);initGame(),c.onclick=function(a){var b=getMousePos(c,a);posX=b.x,posY=b.y,isAlive(posX,posY)?world[posX][posY]=0:world[posX][posY]=1,draw()},c.onmousemove=function(a){var b=getMousePos(c,a);posX=b.x,posY=b.y,mouseX.value=posX,mouseY.value=posY},c.onmouseleave=function(){mouseX.value="",mouseY.value=""},start.onclick=function(){playControl("start",speed)},pause.onclick=function(){playControl("pause"),0!==game&&(start.innerText="Continue")},stop.onclick=function(){playControl("stop"),copyArray(savedFirstGen,world),draw()},next.onclick=function(){step()},customGen.onclick=function(){initGame()},saveCurrent.onclick=function(){copyArray(world,savedFirstGen)},firstGenRandom.onclick=function(){initGame(),setRandomPoints(),copyArray(world,savedFirstGen)},speedInput.oninput=function(){speed=speedInput.value,playControl("pause"),0!==game&&playControl("start",speed)},scaleInput.onchange=function(){scale=scaleInput.value,c.width=width*scale,c.height=height*scale,draw()},fillInput.onchange=function(){fillPercent=fillInput.value/100};